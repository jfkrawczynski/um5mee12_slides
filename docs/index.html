<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.24">

  <meta name="author" content="jean-francois.krawczynski@sorbonne-universite.fr, 2025">
  <title>slides – Particle Image Velocimetry (PIV)</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-d7ae4d2a5b709b8862483cbfb5a50842.css">
  <link rel="stylesheet" href="styles.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Particle Image Velocimetry (PIV)</h1>
  <p class="subtitle">Insights of fluid-flow velocity characterization</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
jean-francois.krawczynski@sorbonne-universite.fr, 2025 
</div>
</div>
</div>

</section>
<section id="fluid-mech." class="slide level2">
<h2>Fluid Mech.:</h2>
<h3 id="equations-are-known">equations are known!</h3>
<span class="math display">\[\begin{align}
&amp; \frac{\partial \rho}{\partial t} + \nabla (\rho \vec{V}) = 0\\
&amp; \rho \left[ \frac{\partial \vec{V}}{\partial t} + (\vec{V} \cdot \nabla ) \vec{V} \right] = -\nabla p + \nabla \sigma + \rho \vec{g}\\
&amp; \frac{\partial \rho E}{\partial t} + \nabla \left[ (\rho E + p) \vec{V} \right] = \nabla (\sigma \vec{V}) + \nabla \vec{q} + \vec{q}_R + \rho \vec{g} \vec{V} + \rho \omega_E\\
&amp; \frac{\partial \rho Y}{\partial t} + \nabla (\rho Y \vec{V}) = \nabla \left[ \rho D \nabla Y \right] + \rho \omega_Y
\end{align}\]</span>
<p>But very few analytical solutions!</p>
</section>
<section id="then-if-i-want" class="slide level2">
<h2>Then, if I want…</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>validate — Are the models and approximations used correct?</li>
<li>verify — some solution?</li>
<li>sizing – Applications to industrial configurations?</li>
<li>(just) better understand things?</li>
</ul>
<div class="fragment fade-in">
<p><span class="math inline">\(\rightarrow\)</span> (Costly) numerical simulations</p>
<p><span class="math inline">\(\rightarrow\)</span> (Costly) experimental measurements</p>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/F18v.png" class="quarto-figure quarto-figure-center" width="350"></p>
</figure>
</div>
</div></div>
</section>
<section>
<section id="why-piv" class="title-slide slide level1 center">
<h1>Why PIV?</h1>

</section>
<section id="measuring-fluid-flow-velocity-principles" class="slide level2">
<h2>Measuring fluid-flow velocity principles</h2>
<ul>
<li>To determine the velocity of an object, <strong>distance</strong> and <strong>time</strong> need to be measured (either the distance traveled during a given time or the time needed to travel a given distance).</li>
<li>But, gases as well as pure liquids do not contain moving objects that reveal the velocity of the fluid.</li>
<li>Thus, many measurement techniques have been developed, determining the flow velocity <strong>indirectly</strong> by measuring other quantities, such as:
<ul>
<li>pressure (pressure probes),</li>
<li>rotational speed (wind anemometer),</li>
<li>heat transfer (hot film, hot wire).</li>
</ul></li>
</ul>
</section>
<section id="alternatives-to-piv-12" class="slide level2">
<h2>Alternatives to PIV (1/2)</h2>
<table class="caption-top">
<colgroup>
<col style="width: 9%">
<col style="width: 29%">
<col style="width: 29%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Pitot tube</th>
<th>Hot Wire Anemometry</th>
<th>Laser Doppler Anemometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Sketch</td>
<td><img data-src="images/pitot1.png" width="250"></td>
<td><img data-src="images/hwa1.png" width="200"></td>
<td><a href="images/lda1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img data-src="images/lda1.png" width="250"></a></td>
</tr>
<tr class="even">
<td>Principle<br> (what is measured)</td>
<td>Static and dynamic pressures.<br> Bernoulli</td>
<td>Joule dissipation measurement in a wire</td>
<td>Interferometric meas. of a Doppler shift on scattering particle</td>
</tr>
<tr class="odd">
<td>Pros</td>
<td>Easy to use. Cheap (1 k€)</td>
<td>High time resolution <br> Medium price (10 k€)</td>
<td>Non intrusive. High time resolution. Suited for several components</td>
</tr>
<tr class="even">
<td>Cons</td>
<td>Highly intrusive.<br> Very poor resolution</td>
<td>Intrusive, fragile. Non linear calibration</td>
<td>Non-regular sampling. High price (50-100 k€). Complex settings</td>
</tr>
</tbody>
</table>
</section>
<section id="alternatives-to-piv-22" class="slide level2">
<h2>Alternatives to PIV (2/2)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>1d time resolved signal: <img data-src="images/1d_sig.png" width="600"></p>
<div class="fragment fade-in">
<p>Therefore, the structure of an unsteady flow field cannot be obtained by such methods.</p>
</div>
</div><div class="column" style="width:50%;">
<div class="fragment fade-in">
<p><video data-src="images/media1.mp4" width="600" controls=""><a href="images/media1.mp4">Video</a></video></p>
</div>
</div></div>
</section>
<section id="piv-principles-12" class="slide level2">
<h2>PIV principles (1/2)</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/piv_princ1.png" class="quarto-figure quarto-figure-center" width="600"></p>
</figure>
</div>
</div><div class="column" style="width:40%;">
<ul>
<li><strong>Seeding</strong>: tracer particles are added to the flow.</li>
<li><strong>Illumination</strong>: these tracer particles have to be illuminated (in a plane) of the flow at least twice within a short and known time interval.</li>
<li><strong>Recording</strong>: the light scattered by the tracer particles on a camera.</li>
<li><strong>Calibration</strong>: to determine the relation between the particle image displacement in the image plane and the tracer particle displacement in the flow.</li>
</ul>
</div></div>
</section>
<section id="piv-principles-22" class="slide level2">
<h2>PIV principles (2/2)</h2>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li><strong>Evaluation</strong>: The displacement of the particle images between the light pulses has to be determined through evaluation of the PIV recordings.</li>
<li><strong>Post-Processing</strong>: In order to detect and remove invalid measurements and to extract complex flow quantities of interest, sophisticated post-processing is required.</li>
</ul>
</div><div class="column" style="width:60%;">
<p><img data-src="images/piv_princ2.png" width="800"></p>
</div></div>
</section>
<section id="piv-pros" class="slide level2">
<h2>PIV pros</h2>
<ul>
<li>The most widely applied velocity imaging technique in fluid mechanics.</li>
<li>PIV is a very robust and accurate technique, which in its most common implementation enables the imaging of two components of velocity in a cross-section of the flow.</li>
<li>PIV measurements are now commonplace and they have been applied in a wide range of gas- and liquid-phase flows, including microfluidics, large-scale wind tunnels, flames, plasmas, and supersonic and hypersonic flows.</li>
</ul>
</section>
<section id="piv-refs" class="slide level2">
<h2>PIV refs</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p>Excellent introductions to PIV can be found in several references:</p>
</div><div class="column" style="width:60%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/raffel.png" class="quarto-figure quarto-figure-center" width="350"></p>
</figure>
</div>
</div></div>
</section></section>
<section>
<section id="physical-and-technical-background" class="title-slide slide level1 center">
<h1>Physical and technical background</h1>

</section>
<section id="tracer-particles" class="slide level2">
<h2>Tracer particles</h2>
<ul>
<li>In contrast to hot wire or pressure probe techniques, PIV is based on the <strong>direct</strong> determination of the 2 fundamental dimensions of the velocity: length and time.</li>
<li>On the other hand, the measurement technique is <strong>indirect</strong> as it determines the velocity of tracer particles instead of the velocity of the fluid.</li>
<li>Therefore, the interaction of the particles and the surrounding fluid has to be examined in order to avoid significant discrepancies between fluid and particle motion.</li>
</ul>
</section>
<section id="tracer-particles-1" class="slide level2">
<h2>Tracer particles</h2>
<h3 id="fluid-mech.-properties-13">Fluid mech. properties (1/3)</h3>
<ul>
<li>A primary source of error is the influence of <strong>gravitational forces</strong> on the velocity of the tracer particles, if the densities of the fluid <span class="math inline">\(\rho\)</span> and the tracer particles <span class="math inline">\(\rho_p\)</span> do not match.</li>
<li>From Stokes’ drag law, assuming spherical particles in a viscous fluid at a very low Reynolds number: <span class="math inline">\(\vec{U}_g = d_p^2 \frac{\rho_p - \rho}{18 \mu} \vec{g}\)</span>.</li>
<li>Therefore, the sedimentation of particles can be avoided if the density of the fluid and particles is identical (<strong>neutral buoyancy</strong>).</li>
<li>This is easily achieved in liquid flows, but not in gas flows. Therefore, the particle diameter must be chosen sufficiently small to minimize the settling velocity of the particles.</li>
</ul>
</section>
<section id="tracer-particles-2" class="slide level2">
<h2>Tracer particles</h2>
<h3 id="fluid-mech.-properties-23">Fluid mech. properties (2/3)</h3>
<div class="columns">
<div class="column" style="width:70%;">
<ul>
<li>Particle frequency response: <span class="math inline">\(\frac{d}{dt}U_p = -18 \frac{\nu}{d_p^2}\frac{U_p - U_f}{\rho_p / \rho_f}\)</span> <span class="math display">\[ \Rightarrow U_p(t) = U_f \left(1-\exp \left( t / \tau_p \right )\right)\]</span> with <span class="math inline">\(\tau_{\rm p} = d_{\rm p}^2 \frac{\rho_{\rm p}}{18 \mu}\)</span>, relaxation time scale of the particle.</li>
</ul>
</div><div class="column" style="width:30%;">
<p><img data-src="images/tau_p.png" width="300"></p>
</div></div>
<ul>
<li>A convenient measure for the tendency of particles to attain velocity equilibrium with the fluid is given by the Stokes number <span class="math display">\[ St = \frac{\tau_{\rm p}}{\tau_{\rm f}}\]</span> where <span class="math inline">\(\tau_f\)</span> stands for the characteristic time scale of the flow (refers to velocity fluctuations along the particle trajectory).</li>
<li>A value of the Stokes number below <span class="math inline">\(10^{-1}\)</span> yields an acceptable flow tracing accuracy.</li>
</ul>
</section>
<section id="tracer-particles-3" class="slide level2">
<h2>Tracer particles</h2>
<h3 id="fluid-mech.-properties-33">Fluid mech. properties (3/3)</h3>
<table class="caption-top">
<colgroup>
<col style="width: 4%">
<col style="width: 23%">
<col style="width: 23%">
<col style="width: 23%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th></th>
<th>Diameter (<span class="math inline">\(\mu m\)</span>)</th>
<th>Relative density</th>
<th>Response time <span class="math inline">\(\tau_p\)</span> (<span class="math inline">\(\mu s\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Water</td>
<td>Hollow glass spheres</td>
<td>10</td>
<td>1.05</td>
<td>0.5</td>
</tr>
<tr class="even">
<td>Water</td>
<td>Aluminium powder</td>
<td>3</td>
<td>2.7</td>
<td>0.9</td>
</tr>
<tr class="odd">
<td>Air</td>
<td>Oil dropplets</td>
<td>1</td>
<td>920</td>
<td>0.3</td>
</tr>
<tr class="even">
<td>Air</td>
<td>SiO<span class="math inline">\(_2\)</span> beads</td>
<td>0.8</td>
<td>2600</td>
<td>5</td>
</tr>
<tr class="odd">
<td>Air</td>
<td>Inflated bubbles</td>
<td>300</td>
<td>1</td>
<td>0.3</td>
</tr>
</tbody>
</table>
</section>
<section id="tracer-particles-generation" class="slide level2">
<h2>Tracer particles generation</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="images/laskin.png" width="500"></p>
</div><div class="column" style="width:50%;">
<p><img data-src="images/pdf_part.png" width="700"></p>
</div></div>
</section>
<section id="light-scattering" class="slide level2">
<h2>Light scattering</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p>PIV image intensity and contrast <span class="math inline">\(\propto\)</span> scattered light power: selecting suitable scattering particles is usually more effective and cost-efficient than increasing laser (illumination) power.</p>
<p><img data-src="images/light_scattered.png" width="500"> <img data-src="images/piv_im1.png" width="700"></p>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/spectre2.png" class="nostretch quarto-figure quarto-figure-center" width="300"></p>
</figure>
</div>
</div></div>
</section>
<section id="light-scattering-1" class="slide level2">
<h2>Light scattering</h2>
<p>For spherical particles with diameters <span class="math inline">\(d_p\)</span> larger than the wavelength of the incident light <span class="math inline">\(\lambda\)</span>, <strong>Mie’s scattering theory</strong> holds.</p>
<div class="columns">
<div class="column" style="width:50%;">
<p>Maximum light diffused at 0°</p>
<div class="line-block">Important parameters:<br>
&nbsp;&nbsp;– Particle type/shape/size<br>
&nbsp;&nbsp;– Refraction index<br>
&nbsp;&nbsp;– Nature of the environment</div>
</div><div class="column" style="width:50%;">
<p><img data-src="images/light_scattered2.png" width="700"></p>
</div></div>
</section>
<section id="illumination-sheet" class="slide level2">
<h2>Illumination sheet</h2>
<p>Use of spherical and cylindrical lenses</p>
<div class="line-block">Important parameters:<br>
&nbsp;&nbsp;– Cylindrical lens curvature and concavity (F2)<br>
&nbsp;&nbsp;– Focal length of the spherical lens (F1)<br>
&nbsp;&nbsp;– Divergence and diameter of the laser beam</div>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/laser_sheet.png" class="quarto-figure quarto-figure-center" width="700"></p>
</figure>
</div>
</section>
<section id="image-recording" class="slide level2">
<h2>Image recording</h2>
<p>See B. Radisson’s lecture.</p>
</section>
<section id="complete-setup-overview" class="slide level2">
<h2>Complete setup overview</h2>

<img data-src="images/piv_setup.png" class="quarto-figure quarto-figure-center r-stretch" width="700"></section>
<section id="resolution-requirements-in-fluid-flows-12" class="slide level2">
<h2>Resolution requirements in fluid flows (1/2)</h2>
<ul>
<li>One of the major difficulties in flow imaging is achieving adequate spatial and temporal resolution. This is particularly the case when flows are turbulent, if it is desired to resolve the smallest scales at which fluctuations occur.</li>
<li>Laminar flows pose less stringent requirements on resolution, compared to turbulent flows. In many laminar shear flows including boundary layers, pipe flows, wakes, jets, and mixing layers, the maximum gradient is the same order of magnitude as the overall gradient, <span class="math display">\[\left(\frac{\partial U}{\partial y} \right)_{\rm max} \approx \frac{\Delta U}{\delta}\]</span> where <span class="math inline">\(\Delta U\)</span> is the characteristic velocity difference, <span class="math inline">\(\delta\)</span> is the local width of the shear flow.</li>
</ul>
</section>
<section id="resolution-requirements-in-fluid-flows-22" class="slide level2">
<h2>Resolution requirements in fluid flows (2/2)</h2>
<ul>
<li>Turbulent flows have substantially more severe resolution requirements than laminar flows, owing to the much larger gradients that occur at the smallest scales of turbulence.</li>
<li>In turbulent flows, the spatial fluctuations range in scale from the largest physical dimension of the flow (e.g., the local width of the boundary layer or jet) to the scale at which diffusion acts to remove all gradients.</li>
<li>The largest scales are often called the ‘‘outer scales,’’ whereas the smallest scales are the ‘‘inner’’ or dissipation scales because these are the scales at which the energy of fluctuations, whether kinetic or scalar, is dissipated.</li>
<li>In classical turbulence theory, the kinetic energy dissipation scale is the Kolmogorov scale <span class="math display">\[\eta \equiv \left( \frac{\nu ^3}{\epsilon} \right)^{1/4}.\]</span></li>
<li>Using scaling arguments, the Kolmogorov scale can also be related to outer scale variables through the relationship, <span class="math inline">\(\eta \propto Re^{-3/4}\)</span>.</li>
</ul>
</section>
<section id="summary" class="slide level2">
<h2>Summary</h2>
<p>Developping a PIV setup is a seek for a compromise regarding,</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="line-block">Reduced inertia of the seeding particles:<br>
&nbsp;&nbsp;– Neutrally buoyant<br>
&nbsp;&nbsp;– As small as possible</div>
<div class="line-block">High visibility:<br>
&nbsp;&nbsp;– Good light scattering<br>
&nbsp;&nbsp;– Large enough</div>
<p>Air vs water</p>
<p>Application</p>
</div><div class="column" style="width:50%;">
<p><img data-src="images/spectre_turb.png" width="700"></p>
</div></div>
</section></section>
<section>
<section id="image-evaluation-methods" class="title-slide slide level1 center">
<h1>Image evaluation methods</h1>

</section>
<section id="frame-1" class="slide level2" data-background="#43464B" data-background-image="images/piv_frame1.png">
<h2>Frame 1</h2>
</section>
<section id="frame-2" class="slide level2" data-background="#43464B" data-background-image="images/piv_frame2.png">
<h2>Frame 2</h2>
</section>
<section id="objective" class="slide level2">
<h2>Objective</h2>
<p>Estimate a <strong>velocity-field</strong> from a couple of <strong>grayscale particle images</strong>, i.e.&nbsp;find <span class="math inline">\(\vec{V}(\vec{x},t)\)</span> from <span class="math inline">\(I(\vec{x},t,t+\Delta t)\)</span>, <span class="math inline">\(I \in [0,255]\)</span>.</p>
<ul>
<li>Ideally, a high data density is preferred on the PIV vector fields, particularly when significant spatial flow variations must be resolved or when comparing experimental data with numerical results.</li>
<li>This requires a medium concentration of the images of the tracer particles in the PIV recording.</li>
<li>Medium image concentration is characterized by the fact that matching pairs of particle images – due to subsequent illuminations – cannot be detected by visual inspection.</li>
<li>Hence, statistical approaches were developed.</li>
</ul>
</section>
<section id="from-ivecxttdelta-t-i-in-0255" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">From <span class="math inline">\(I(\vec{x},t,t+\Delta t)\)</span>, <span class="math inline">\(I \in [0,255]\)</span></h2>
<div id="b878de6c" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode python hljs"><span id="cb1-1" class="hljs-ln-code"><a></a><span class="co"># import the standard numerical and plotting packages</span></span>
<span id="cb1-2" class="hljs-ln-code"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3" class="hljs-ln-code"><a></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4" class="hljs-ln-code"><a></a><span class="co"># import what is necessary from OpenPIV</span></span>
<span id="cb1-5" class="hljs-ln-code"><a></a><span class="im">from</span> openpiv <span class="im">import</span> tools</span>
<span id="cb1-6" class="hljs-ln-code"><a></a></span>
<span id="cb1-7" class="hljs-ln-code"><a></a><span class="co"># load the images</span></span>
<span id="cb1-8" class="hljs-ln-code"><a></a>a <span class="op">=</span> tools.imread(<span class="st">"./images/B005_1.tif"</span>)</span>
<span id="cb1-9" class="hljs-ln-code"><a></a>b <span class="op">=</span> tools.imread(<span class="st">"./images/B005_2.tif"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="from-ivecxttdelta-t-i-in-0255-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">From <span class="math inline">\(I(\vec{x},t,t+\Delta t)\)</span>, <span class="math inline">\(I \in [0,255]\)</span></h2>
<div id="cdfe94f2" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode python hljs"><span id="cb2-1" class="hljs-ln-code"><a></a><span class="co"># import the standard numerical and plotting packages</span></span>
<span id="cb2-2" class="hljs-ln-code"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3" class="hljs-ln-code"><a></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-4" class="hljs-ln-code"><a></a><span class="co"># import what is necessary from OpenPIV</span></span>
<span id="cb2-5" class="hljs-ln-code"><a></a><span class="im">from</span> openpiv <span class="im">import</span> tools</span>
<span id="cb2-6" class="hljs-ln-code"><a></a></span>
<span id="cb2-7" class="hljs-ln-code"><a></a><span class="co"># load the images</span></span>
<span id="cb2-8" class="hljs-ln-code"><a></a>a <span class="op">=</span> tools.imread(<span class="st">"./images/B005_1.tif"</span>)</span>
<span id="cb2-9" class="hljs-ln-code"><a></a>b <span class="op">=</span> tools.imread(<span class="st">"./images/B005_2.tif"</span>)</span>
<span id="cb2-10" class="hljs-ln-code"><a></a></span>
<span id="cb2-11" class="hljs-ln-code"><a></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">4</span>))</span>
<span id="cb2-12" class="hljs-ln-code"><a></a>img <span class="op">=</span> axs[<span class="dv">0</span>].imshow(a, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">100</span>, cmap<span class="op">=</span>plt.cm.gray)</span>
<span id="cb2-13" class="hljs-ln-code"><a></a>axs[<span class="dv">0</span>].set_title(<span class="st">'frame A'</span>)</span>
<span id="cb2-14" class="hljs-ln-code"><a></a>img <span class="op">=</span> axs[<span class="dv">1</span>].imshow(b, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">100</span>, cmap<span class="op">=</span>plt.cm.gray)</span>
<span id="cb2-15" class="hljs-ln-code"><a></a>axs[<span class="dv">1</span>].set_title(<span class="st">'frame B'</span>)</span>
<span id="cb2-16" class="hljs-ln-code"><a></a>cbar <span class="op">=</span> fig.add_axes([<span class="fl">0.95</span>, <span class="fl">0.1</span>, <span class="fl">0.03</span>, <span class="fl">0.8</span>])</span>
<span id="cb2-17" class="hljs-ln-code"><a></a>fig.colorbar(img, cax<span class="op">=</span>cbar)</span>
<span id="cb2-18" class="hljs-ln-code"><a></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell fragment" data-execution_count="2">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/cell-3-output-1.png" width="823" height="357"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="windowing" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Windowing</h2>
<p>Let’s focus on small portions of the images:</p>
<div id="2dd1c94c" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode python hljs"><span id="cb3-1" class="hljs-ln-code"><a></a>win_size <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb3-2" class="hljs-ln-code"><a></a>a_win <span class="op">=</span> a[:win_size, :win_size].copy()</span>
<span id="cb3-3" class="hljs-ln-code"><a></a>b_win <span class="op">=</span> b[:win_size, :win_size].copy()</span>
<span id="cb3-4" class="hljs-ln-code"><a></a></span>
<span id="cb3-5" class="hljs-ln-code"><a></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">4</span>))</span>
<span id="cb3-6" class="hljs-ln-code"><a></a>img <span class="op">=</span> axs[<span class="dv">0</span>].imshow(a_win, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">100</span>, cmap<span class="op">=</span>plt.cm.gray)</span>
<span id="cb3-7" class="hljs-ln-code"><a></a>axs[<span class="dv">0</span>].set_title(<span class="st">'IA'</span>)</span>
<span id="cb3-8" class="hljs-ln-code"><a></a>img <span class="op">=</span> axs[<span class="dv">1</span>].imshow(b_win, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">100</span>, cmap<span class="op">=</span>plt.cm.gray)</span>
<span id="cb3-9" class="hljs-ln-code"><a></a>axs[<span class="dv">1</span>].set_title(<span class="st">'IB'</span>)</span>
<span id="cb3-10" class="hljs-ln-code"><a></a>cbar <span class="op">=</span> fig.add_axes([<span class="fl">0.95</span>, <span class="fl">0.1</span>, <span class="fl">0.03</span>, <span class="fl">0.8</span>])</span>
<span id="cb3-11" class="hljs-ln-code"><a></a>fig.colorbar(img, cax<span class="op">=</span>cbar)</span>
<span id="cb3-12" class="hljs-ln-code"><a></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell fragment" data-execution_count="3">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/cell-4-output-1.png" width="815" height="357"></p>
</figure>
</div>
</div>
</div>
<p>The movement of individual particles from frame A to frame B is untrackable by “hand”.</p>
</section>
<section id="shifting" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Shifting</h2>
<p>We could then try to shift the window IA by some pixels along the horizontal and/or vertical directions</p>
<div id="b1933eb8" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" data-code-line-numbers="2,4,6"><pre class="sourceCode numberSource python number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode python hljs"><span id="cb4-1" class="hljs-ln-code"><a></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">4</span>))</span>
<span id="cb4-2" class="hljs-ln-code"><a></a>img <span class="op">=</span> axs[<span class="dv">0</span>].imshow(b_win <span class="op">-</span> a_win, cmap<span class="op">=</span>plt.cm.gray)</span>
<span id="cb4-3" class="hljs-ln-code"><a></a>axs[<span class="dv">0</span>].set_title(<span class="st">"IB - IA(shift=0)"</span>)</span>
<span id="cb4-4" class="hljs-ln-code"><a></a>img <span class="op">=</span> axs[<span class="dv">1</span>].imshow(b_win <span class="op">-</span> np.roll(a_win, (<span class="dv">1</span>, <span class="dv">0</span>), axis<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>)), cmap<span class="op">=</span>plt.cm.gray)</span>
<span id="cb4-5" class="hljs-ln-code"><a></a>axs[<span class="dv">1</span>].set_title(<span class="st">"IB - IA(shift=1 pxl)"</span>)</span>
<span id="cb4-6" class="hljs-ln-code"><a></a>img <span class="op">=</span> axs[<span class="dv">2</span>].imshow(b_win <span class="op">-</span> np.roll(a_win, (<span class="dv">2</span>, <span class="dv">0</span>), axis<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>)), cmap<span class="op">=</span>plt.cm.gray)</span>
<span id="cb4-7" class="hljs-ln-code"><a></a>axs[<span class="dv">2</span>].set_title(<span class="st">"IB - IA(shift=2 pxl)"</span>)</span>
<span id="cb4-8" class="hljs-ln-code"><a></a>cbar <span class="op">=</span> fig.add_axes([<span class="fl">0.95</span>, <span class="fl">0.1</span>, <span class="fl">0.03</span>, <span class="fl">0.8</span>])</span>
<span id="cb4-9" class="hljs-ln-code"><a></a>fig.colorbar(img, cax<span class="op">=</span>cbar)</span>
<span id="cb4-10" class="hljs-ln-code"><a></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell fragment" data-execution_count="4">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/cell-5-output-1.png" width="819" height="334"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="optimal-matching" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Optimal matching?</h2>
<p>Let’s try to find the best shift algorithmically: shift and calculate the sum of squared differences, the minimum of which should be the best shift.</p>
<div id="0defaa6c" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" data-code-line-numbers="|16"><pre class="sourceCode numberSource python number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode python hljs"><span id="cb5-1" class="hljs-ln-code"><a></a><span class="kw">def</span> match_template(img, template, maxroll<span class="op">=</span><span class="dv">8</span>):</span>
<span id="cb5-2" class="hljs-ln-code"><a></a>    <span class="co"># img: input image to compare</span></span>
<span id="cb5-3" class="hljs-ln-code"><a></a>    <span class="co"># template: image to match against</span></span>
<span id="cb5-4" class="hljs-ln-code"><a></a>    <span class="co"># maxroll: max nbr of pxl to shift in each dir. Default value is 8.</span></span>
<span id="cb5-5" class="hljs-ln-code"><a></a>    best_dist <span class="op">=</span> np.inf</span>
<span id="cb5-6" class="hljs-ln-code"><a></a>    best_shift <span class="op">=</span> (<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb5-7" class="hljs-ln-code"><a></a>    <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(<span class="op">-</span>maxroll,maxroll):</span>
<span id="cb5-8" class="hljs-ln-code"><a></a>        <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="op">-</span>maxroll,maxroll):</span>
<span id="cb5-9" class="hljs-ln-code"><a></a>            <span class="co"># calculate Euclidean distance</span></span>
<span id="cb5-10" class="hljs-ln-code"><a></a>            dist <span class="op">=</span> np.sqrt(np.<span class="bu">sum</span>((img <span class="op">-</span> np.roll(template, (y, x), axis<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>))) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb5-11" class="hljs-ln-code"><a></a>            <span class="cf">if</span> dist <span class="op">&lt;</span> best_dist:</span>
<span id="cb5-12" class="hljs-ln-code"><a></a>                best_dist <span class="op">=</span> dist</span>
<span id="cb5-13" class="hljs-ln-code"><a></a>                best_shift <span class="op">=</span> (y, x)</span>
<span id="cb5-14" class="hljs-ln-code"><a></a>    <span class="cf">return</span> (best_dist, best_shift)</span>
<span id="cb5-15" class="hljs-ln-code"><a></a><span class="co"># Let’s check that it works by manually shifting the same image (IA):</span></span>
<span id="cb5-16" class="hljs-ln-code"><a></a>match_template(np.roll(a_win, (<span class="dv">2</span>, <span class="dv">0</span>), axis<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>)), a_win)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell fragment" data-execution_count="5">
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>(0.0, (2, 0))</code></pre>
</div>
</div>
</section>
<section id="optimal-matching-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Optimal matching?</h2>
<p>Let’s try to find the best shift algorithmically: shift and calculate the sum of squared differences, the minimum of which should be the best shift.</p>
<div id="785bed25" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode python hljs"><span id="cb7-1" class="hljs-ln-code"><a></a><span class="co"># Let’s try it on the two sub-windows</span></span>
<span id="cb7-2" class="hljs-ln-code"><a></a>match_template(b_win, a_win)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell fragment" data-execution_count="6">
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>(123.80226169178009, (-1, 1))</code></pre>
</div>
</div>
<div class="fragment fade-in">
<p>Well, this is not the true displacement, but it gives a hint.</p>
<p>The problem is that shifting each image and repeating the loop many times is impractical.</p>
</div>
</section>
<section id="optimal-matching-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Optimal matching?</h2>
<p>Let’s use a different matching principle, based on the <strong>cross-correlation</strong>:</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math display">\[R_{II}(x,y) = \sum_{i=-K}^K \sum_{j=-L}^L I(i,j) I'(i+x,j+y)\]</span></p>
<ul>
<li><span class="math inline">\(I(x,y) =\)</span> Pixel grayscale <span class="math inline">\((i,j)\)</span> of the 1st image (instant <span class="math inline">\(t\)</span>)</li>
<li><span class="math inline">\(I'(x,y) =\)</span> Pixel grayscale <span class="math inline">\((i,j)\)</span> of the 2nd image (instant <span class="math inline">\(t+\Delta t\)</span>)</li>
<li><span class="math inline">\(2K\)</span>, <span class="math inline">\(2L\)</span> = Dimension of the analysis area (mesh).</li>
</ul>
<p>This is statistical information. We do not look for particle-to-particle speed!</p>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/cc1.png" class="quarto-figure quarto-figure-center" width="400"></p>
</figure>
</div>
</div></div>
</section>
<section id="cc-interrogation-technic" class="slide level2">
<h2>CC interrogation technic</h2>
<p>Direct calculation: very long! : <span class="math inline">\(2M^2N^2\)</span> operations <span class="math inline">\(\Rightarrow\)</span> Calculation of the correlation function by FFT: <span class="math inline">\(2N^2\log_2N\)</span> (if <span class="math inline">\(N=M\)</span>).</p>

<img data-src="images/cc2.png" width="700" class="r-stretch"></section>
<section id="cc-interrogation-technic-1" class="slide level2">
<h2>CC interrogation technic</h2>
<p>CC is an efficient computational algorithm to find out the right shift.</p>
<div id="b4c7e183" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a><span class="co"># import the required package</span></span>
<span id="cb9-2"><a></a><span class="im">from</span> scipy.signal <span class="im">import</span> correlate</span>
<span id="cb9-3"><a></a></span>
<span id="cb9-4"><a></a>cross_corr <span class="op">=</span> correlate(b_win <span class="op">-</span> b_win.mean(), a_win <span class="op">-</span> a_win.mean(), method<span class="op">=</span><span class="st">"fft"</span>)</span>
<span id="cb9-5"><a></a><span class="co"># let's see what the cross-correlation looks like</span></span>
<span id="cb9-6"><a></a>Y, X <span class="op">=</span> np.meshgrid(np.arange(cross_corr.shape[<span class="dv">0</span>]), np.arange(cross_corr.shape[<span class="dv">1</span>]))</span>
<span id="cb9-7"><a></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb9-8"><a></a>ax <span class="op">=</span> fig.add_subplot(projection<span class="op">=</span><span class="st">"3d"</span>)</span>
<span id="cb9-9"><a></a>ax.plot_surface(Y, X, cross_corr, cmap<span class="op">=</span><span class="st">'jet'</span>, linewidth<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb9-10"><a></a>plt.title(<span class="st">"Correlation map — peak is the most probable shift"</span>)</span>
<span id="cb9-11"><a></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell fragment" data-execution_count="7">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/cell-8-output-1.png" width="439" height="414"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cc-interrogation-technic-2" class="slide level2 scrollable">
<h2>CC interrogation technic</h2>
<p>We can get the first velocity field by repeating this analysis for all windows.</p>
<div id="a224fbf6" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a><span class="kw">def</span> vel_field(curr_frame, next_frame, win_size):</span>
<span id="cb10-2"><a></a>    ys <span class="op">=</span> np.arange(<span class="dv">0</span>, curr_frame.shape[<span class="dv">0</span>], win_size)</span>
<span id="cb10-3"><a></a>    xs <span class="op">=</span> np.arange(<span class="dv">0</span>, curr_frame.shape[<span class="dv">1</span>], win_size)</span>
<span id="cb10-4"><a></a>    dys <span class="op">=</span> np.zeros((<span class="bu">len</span>(ys), <span class="bu">len</span>(xs)))</span>
<span id="cb10-5"><a></a>    dxs <span class="op">=</span> np.zeros((<span class="bu">len</span>(ys), <span class="bu">len</span>(xs)))</span>
<span id="cb10-6"><a></a>    <span class="cf">for</span> iy, y <span class="kw">in</span> <span class="bu">enumerate</span>(ys):</span>
<span id="cb10-7"><a></a>        <span class="cf">for</span> ix, x <span class="kw">in</span> <span class="bu">enumerate</span>(xs):</span>
<span id="cb10-8"><a></a>            int_win <span class="op">=</span> curr_frame[y : y <span class="op">+</span> win_size, x : x <span class="op">+</span> win_size]</span>
<span id="cb10-9"><a></a>            search_win <span class="op">=</span> next_frame[y : y <span class="op">+</span> win_size, x : x <span class="op">+</span> win_size]</span>
<span id="cb10-10"><a></a>            cross_corr <span class="op">=</span> correlate(</span>
<span id="cb10-11"><a></a>                search_win <span class="op">-</span> search_win.mean(), int_win <span class="op">-</span> int_win.mean(), method<span class="op">=</span><span class="st">"fft"</span></span>
<span id="cb10-12"><a></a>            )</span>
<span id="cb10-13"><a></a>            dys[iy, ix], dxs[iy, ix] <span class="op">=</span> (</span>
<span id="cb10-14"><a></a>                np.unravel_index(np.argmax(cross_corr), cross_corr.shape)</span>
<span id="cb10-15"><a></a>                <span class="op">-</span> np.array([win_size, win_size])</span>
<span id="cb10-16"><a></a>                <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb10-17"><a></a>            )</span>
<span id="cb10-18"><a></a>    <span class="co"># locate velocity vectors from the center of each window</span></span>
<span id="cb10-19"><a></a>    ys <span class="op">=</span> ys <span class="op">+</span> win_size <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb10-20"><a></a>    xs <span class="op">=</span> xs <span class="op">+</span> win_size <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb10-21"><a></a>    <span class="cf">return</span> xs, ys, dxs, dys</span>
<span id="cb10-22"><a></a></span>
<span id="cb10-23"><a></a>xs, ys, dxs, dys <span class="op">=</span> vel_field(a, b, <span class="dv">32</span>)</span>
<span id="cb10-24"><a></a>norm_drs <span class="op">=</span> np.sqrt(dxs <span class="op">**</span> <span class="dv">2</span> <span class="op">+</span> dys <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb10-25"><a></a></span>
<span id="cb10-26"><a></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">4</span>))</span>
<span id="cb10-27"><a></a>ax.quiver(</span>
<span id="cb10-28"><a></a>    xs,</span>
<span id="cb10-29"><a></a>    ys[::<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb10-30"><a></a>    dxs,</span>
<span id="cb10-31"><a></a>    <span class="op">-</span>dys,</span>
<span id="cb10-32"><a></a>    norm_drs,</span>
<span id="cb10-33"><a></a>    cmap<span class="op">=</span><span class="st">"plasma"</span>,</span>
<span id="cb10-34"><a></a>    angles<span class="op">=</span><span class="st">"xy"</span>,</span>
<span id="cb10-35"><a></a>    scale_units<span class="op">=</span><span class="st">"xy"</span>,</span>
<span id="cb10-36"><a></a>    scale<span class="op">=</span><span class="fl">0.25</span>,</span>
<span id="cb10-37"><a></a>)</span>
<span id="cb10-38"><a></a>ax.set_aspect(<span class="st">"equal"</span>)</span>
<span id="cb10-39"><a></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell fragment" data-execution_count="8">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/cell-9-output-1.png" width="351" height="337"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cc-interrogation-technic-3" class="slide level2">
<h2>CC interrogation technic</h2>
<p>Let’s have a look back at the CC map:</p>
<div class="columns">
<div class="column" style="width:50%;">
<div id="dcbb2dca" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a>plt.imshow(cross_corr, cmap<span class="op">=</span>plt.cm.gray)</span>
<span id="cb11-2"><a></a>y, x <span class="op">=</span> np.unravel_index(cross_corr.argmax(), cross_corr.shape)</span>
<span id="cb11-3"><a></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>y<span class="op">=</span><span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>x<span class="op">=</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-4"><a></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell fragment" data-execution_count="9">
<div class="cell-output cell-output-stdout">
<pre><code>y=30, x=32</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/cell-10-output-2.png" width="415" height="413"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="fragment fade-in">
<ul>
<li><p>The information is discrete (pxl)! Very high uncertainty for displacements close to 1 pxl</p></li>
<li><p>Sub-pixel interpolation of the correlation peak (Gaussian, parabolic, etc.) over 3, 5 or 7 pxls <span class="math inline">\(\Rightarrow\)</span> theoretical accuracy 0.01 pxl.</p></li>
</ul>
<p><img data-src="images/cc3.png" width="900"></p>
</div>
</div></div>
</section>
<section id="cc-interrogation-technic-4" class="slide level2">
<h2>CC interrogation technic</h2>
<h3 id="errors">errors</h3>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>The interpolation of correlation peaks causes a bias towards integer values displacements (Peak locking effect)</li>
<li>This effect increases when the particle image size &lt; 2 pixels</li>
<li>Solutions to correct this effect: choice of the interpolation function, iterative PIV, etc. <img data-src="images/peak_lock.png" width="700"></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="fragment fade-in">
<div class="line-block">Particle size on image results from:<br>
&nbsp;&nbsp;– Actual particle size<br>
&nbsp;&nbsp;– Particle brigthness<br>
&nbsp;&nbsp;– Sensor pixel size<br>
&nbsp;&nbsp;– Focus</div>
<p><img data-src="images/error_dp.png" width="700"></p>
</div>
</div></div>
</section>
<section id="parameters" class="slide level2">
<h2>Parameters</h2>
<h3 id="taking-good-quality-images-is-an-art">Taking good quality images is an art!</h3>
<div class="columns">
<div class="column" style="width:50%;">
<div class="fragment fade-in">
<ul>
<li>Homogeneous, regular tracer density <span class="math inline">\(\rightarrow\)</span> correlation relevance</li>
</ul>
</div>
<div class="fragment fade-in">
<ul>
<li>Particle image size (ideal: ~3/4 pixels): Detectability / Pixel locking</li>
</ul>
</div>
<div class="fragment fade-in">
<ul>
<li>No saturation of particle images on the CCD sensor</li>
</ul>
</div>
<div class="fragment fade-in">
<ul>
<li>No reflection, background noise,…</li>
</ul>
</div>
</div><div class="column" style="width:50%;">
<div class="fragment fade-in">
<ul>
<li>Gaussian laser beams</li>
</ul>
</div>
<div class="fragment fade-in">
<ul>
<li>Superimposed laser sheets, ideal thickness ~ 500μm</li>
</ul>
</div>
<div class="fragment fade-in">
<ul>
<li>Time between pulses: In plane displacement =&gt; resolution Out of plane displacement =&gt; lost particles</li>
</ul>
</div>
</div></div>
<div class="fragment fade-in">
<p><img data-src="images/cc_seeding.png" width="1000"></p>
</div>
</section>
<section id="parameters-1" class="slide level2">
<h2>Parameters</h2>
<p>Correlation coefficient for different displacements, i.e.&nbsp;different time between pulses</p>
<div class="fragment fade-in">
<p><img data-src="images/cc_disp.png" width="1000"></p>
</div>
</section>
<section id="spatial-resolution" class="slide level2">
<h2>Spatial resolution</h2>
<p>Typical mesh sizes: <span class="math inline">\(32 \times 32\)</span>, <span class="math inline">\(64 \times 64\)</span>, <span class="math inline">\(128 \times 128\)</span> pixel <span class="math inline">\(^2\)</span></p>
<p>Typical pixel size: <span class="math inline">\(0.1\)</span> mm to <span class="math inline">\(1\)</span> mm</p>

<img data-src="images/vort1.png" width="1000" class="r-stretch"></section>
<section id="spatial-resolution-1" class="slide level2">
<h2>Spatial resolution</h2>
<p>Overlaping of the interrogation windows: typically 50%, 75%</p>

<img data-src="images/overlap.png" width="1000" class="r-stretch"></section>
<section id="spatial-resolution-2" class="slide level2">
<h2>Spatial resolution</h2>
<p>If strong gradients</p>

<img data-src="images/grad.png" width="1000" class="r-stretch"><p><span class="math inline">\(\rightarrow\)</span> towards multi-pass</p>
</section>
<section id="multi-pass" class="slide level2">
<h2>Multi-pass</h2>

<img data-src="images/multipass.png" width="1000" class="r-stretch"></section>
<section id="validation-procedure" class="slide level2">
<h2>Validation procedure</h2>
<p>Quality factor (signal-to-noise ratio):</p>

<img data-src="images/qual_fac.png" class="quarto-figure quarto-figure-center r-stretch" width="1000"></section>
<section id="validation-procedure-1" class="slide level2">
<h2>Validation procedure</h2>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li>Comparison of vectors with their <span class="math inline">\(k \equiv [i-N:i+N,j-N:j+N]\)</span> neighbors: suppression/replacement if, e.g., <span class="math display">\[V_{ij} &gt; \overline{V_k} \pm K \times {\rm RMS(neighbors)}\]</span></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/val_neigh.png" class="quarto-figure quarto-figure-center" width="200"></p>
</figure>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:50%;">
<div class="fragment fade-in">
<ul>
<li>Spatial filtering (vectors interpolation): Post-processing is not an artistic creation! It is necessary to remove the noise as much as possible without removing the signal</li>
</ul>
<p><img data-src="images/fil_im.png" width="500"></p>
</div>
</div></div>
</section>
<section id="and-more" class="slide level2">
<h2>And More…</h2>
<ul>
<li><a href="https://?meta:prerelease-subdomainquarto.org/docs/presentations/revealjs/#footer-logo">Footer &amp; Logo</a> (optionally specify custom footer per-slide or hide global footer)</li>
<li><a href="https://?meta:prerelease-subdomainquarto.org/docs/presentations/revealjs/presenting.html#multiplex">Multiplex</a> (allows your audience to follow the slides of the presentation you are controlling on their own phone, tablet or laptop).</li>
</ul>
<div class="footer">
<p>Learn more: <a href="https://?meta:prerelease-subdomainquarto.org/docs/presentations/revealjs/">Quarto Presentations</a></p>
</div>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>UM5MEE12 – Experimental technics and data analysis, 2025</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'pdfMaxPagesPerSlide': 1,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true,"numbers":true},
'chalkboard': {"buttons":true},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    <script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
    (function() {
      let previousOnload = window.onload;
      window.onload = () => {
        if (previousOnload) {
          previousOnload();
        }
        lightboxQuarto.on('slide_before_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          const href = trigger.getAttribute('href');
          if (href !== null) {
            const imgEl = window.document.querySelector(`a[href="${href}"] img`);
            if (imgEl !== null) {
              const srcAttr = imgEl.getAttribute("src");
              if (srcAttr && srcAttr.startsWith("data:")) {
                slideConfig.href = srcAttr;
              }
            }
          } 
        });
      
        lightboxQuarto.on('slide_after_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(slideNode);
          }
        });
      
      };
      
    })();
              </script>
    

</body></html>